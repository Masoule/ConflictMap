<!DOCTYPE html>
<html>

  <head>
  	<title>D3 Mapping Timeline</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css" />

    <style>
      path {
        fill: none;
        stroke: #333;
        stroke-width: .5px;
      }

      .land-boundary {
        stroke-width: 1px;
      }

      .county-boundary {
        stroke: #ddd;
      }

      .site {
      	stroke-width: .5px;
        stroke: #333;
        fill: #9cf;
      }


    </style>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript" src="../src/main.js"></script>
    <script src="https://d3js.org/d3-geo.v1.min.js"></script>
    <!-- <script src="/datamaps.world.min.js"></script> -->
    <!-- <script src="node_modules/datamaps/dist/datamaps.world.min.js"></script> -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <!-- <script src="../src/main.js"></script> -->
  </head>

    <body>
      <h1>Violence</h1>
      <div class="">
      </div>

      <div id="slider3"></div>

      <script>
      var width = 960,
          height = 600;

      var mapPath = "https://unpkg.com/world-atlas@1/world/110m.json";

      var projection = d3.geo.equirectangular()
          .translate([width / 2, height / 2]);
          // .scale(1280)
      //
      var path = d3.geo.path()
          .projection(projection);

      var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height);

      d3.json(mapPath, function(error, worldMap) {
        if (error) return console.error(error);

        svg.append("path")
            .datum(topojson.feature(worldMap, worldMap.objects.land))
            .attr("d", path)
            .attr("class", "land-boundary");

        svg.append("path")
            .datum(topojson.mesh(worldMap, worldMap.objects.countries, function(a, b) { return a !== b && (a.id / 1000 | 0) === (b.id / 1000 | 0); }))
            .attr("d", path)
            .attr("class", "country-boundary");

        d3.csv("data.csv")
          .row(function(d) {
            return {
              lat: parseFloat(d.lat),
              lng: parseFloat(d.lng),
              location: d.location,
              description: d.description,
              year: parseInt(d.year),
              killed: parseInt(d.killed),
            };
          })
          .get(function(err, rows) {
          	if (err) return console.error(err);
            window.rows = rows;
            rows.map((row)=>
            svg.append('circle')
            .attr('class','site')
            .attr('cx', projection([row.lng,row.lat])[0])
            .attr('cy', projection([row.lat,row.lat])[1])
            .attr('r', (row.killed)/10000)
          )
          });
      });

      </script>
      <script src="bundle.js"></script>

    </body>

</html>
